# E-Commerce Backend API
This repository contains the backend implementation for an e-commerce platform. The application is built according to the requirements given in the AJI subject course delivered at TUL. Among the technologies used are **Express.js** as the backend framework, **PostreSQL** as the relational database, and **Knex.js** with **Bookshelf.js** for ORM. The API provides endpoints for managing products, categories, orders, and order statuses, along with additional features such as SEO-optimized product descriptions, user authentication, database initialization, and order reviews.

## Features
### Core Features
1. **Product management:** User can list all products, retrieve a single product by ID, add a new product, update an existing product.
2. **Category management:** User can list all predefined categories.
3. **Order management:** User can list all orders, retrieve a single order by ID, retrieve orders by username, create a new order, update the status of an existing order, list orders by status.
4. **Order Status management:** User can list all predefined order statuses.

### Additional Features
1. **SEO-Optimized Product Descriptions:** User can generate SEO-optimized descriptions for products using a language model (Groq API).
2. **User Authentication:** All endpoints were secured using JWT. To access the secured endpoint to use JWT token which is generated by login operation if the credentials (username, password) are correct. The token expires in 1 hour. After that time the user need to generate new token to use endpoins.
3. **Database Initialization:** User can initialize the database with product data from a JSON data given in the input field. 
4. **Order Reviews:** User can add reviews to completed or canceled orders. Reviews include a rating (1-5) and a text comment. Only the user who placed the order can add a review.

## API Endpoints
### Products
- **GET /products** - Retrieve all products.
- **GET /products/:id** - Retrieve a single product by ID.
- **POST /products** - Add a new product.
- **PUT /products/:id** - Update an existing product.
- **GET /products/:id/seo-description** - Generate an SEO-optimized description for a product.

### Categories
- **GET /categories** - Retrieve all predefined categories.

### Orders 
- **GET /orders** - Retrieve all orders.
- **POST /orders** - Add a new order.
- **PATCH /orders/:id** - Update the status of an order.
- **GET /orders/status/:statusId** - Retrieve orders by status.
- **POST /orders/:id/opinions** - Add a review to an order.

### Order Statuses
- **GET /status** - Retrieve all predefined order statuses.

### Authentication
- **POST /login** - Authenticate and generate a JWT token.

### Database Initialization
- **POST /init** - Initialize the database with product data in a JSON format.

## Setup Instructions
### Prerequisites
1. Install **Node.js** and **npm**.
2. Install **PostgreSQL** and create a database for the application.
3. Clone this repository.

### Installation
1. Install dependencies: ***npm install*** (WARNING: if there any errors caused by packages inconsistency run ***yarn install*** instead)
2. Run database migrations: ***npx knex migrate:latest***
3. Start the server: ***npm run server***

Alternatively, the application can be started by extecuting "start" command defined in the package.json file from the user's IDE.

## Testing the API
You can use tools like **Postman** or **cURL** to test the API endpoints. The endpoints are secured so every request requires a valid token. Token can be generated by sending request to the **POST /login** endpoint.
To log in as a client please use the following credencials:
```
POST /login
Body: {
    "username": "client"
    "password": "P@ssw0rd!"
}
```
To log in as a administrator please use the following credencials:
```
POST /login
Body: {
    "username": "bfox"
    "password": "P@ssw0rd!"
}
```

Below are some example requests:

1. Add a new product:
```
POST /products
Body: {
  "name": "Sample Product",
  "description": "This is a sample product.",
  "price": 19.99,
  "weight": 1.5,
  "categoryId": 1
}
```
2. Update an order status:
```
PATCH /orders/1
Body: {
  "statusId": 2
}
```
3. Generate an SEO-optimized description:
```
GET /products/1/seo-description
```

## Additional Notes
- The database schema is defined in the migration file (migrations folder).
- The implementation includes validation and error handling.

## Authors

### Wiktoria Bilecka
### Grzegorz Janasek
